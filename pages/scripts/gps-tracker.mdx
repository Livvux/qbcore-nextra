# GPS Tracker Script

High-performance GPS tracking system with universal framework compatibility, designed to provide accurate navigation and location services for QBCore servers.

## Features

### üåê Universal Compatibility
- **Multi-Framework**: Works with QBCore, ESX, and standalone configurations
- **Performance Optimized**: Minimal resource usage with maximum functionality
- **Real-time Updates**: Live GPS tracking with smooth map integration
- **Mobile Responsive**: Compatible with in-game phone systems

### üìç Core Features
- **Real-time GPS Navigation**: Turn-by-turn directions with voice guidance
- **Waypoint System**: Set and manage custom waypoints
- **Location Sharing**: Share locations with other players
- **Route Planning**: Automatic route optimization
- **Speed Monitoring**: Track vehicle speed and compliance
- **Geofencing**: Create custom zones with entry/exit alerts
- **Location History**: Track and review visited locations
- **Emergency Services Integration**: Quick access for police/EMS

## Installation

### Prerequisites
- QBCore Framework (or compatible framework)
- Modern FiveM server setup
- Database access for location storage

### Quick Installation

1. **Download GPS Tracker**
   ```bash
   cd resources/[scripts]
   git clone https://github.com/example/gps-tracker.git
   ```

2. **Database Setup**
   ```sql
   -- Execute in your database
   CREATE TABLE IF NOT EXISTS `gps_waypoints` (
     `id` int(11) NOT NULL AUTO_INCREMENT,
     `citizenid` varchar(50) NOT NULL,
     `name` varchar(100) NOT NULL,
     `x` float NOT NULL,
     `y` float NOT NULL,
     `z` float NOT NULL,
     `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
     PRIMARY KEY (`id`),
     KEY `citizenid` (`citizenid`)
   );
   
   CREATE TABLE IF NOT EXISTS `gps_history` (
     `id` int(11) NOT NULL AUTO_INCREMENT,
     `citizenid` varchar(50) NOT NULL,
     `location` varchar(200) NOT NULL,
     `x` float NOT NULL,
     `y` float NOT NULL,
     `z` float NOT NULL,
     `visited_at` timestamp DEFAULT CURRENT_TIMESTAMP,
     PRIMARY KEY (`id`),
     KEY `citizenid` (`citizenid`)
   );
   ```

3. **Server Configuration**
   ```cfg
   # Add to server.cfg
   start gps-tracker
   
   # Optional: Configure update rate
   setr gps:update_interval "1000"
   setr gps:max_waypoints "50"
   ```

4. **Dependencies**
   ```cfg
   # Ensure dependencies are loaded first
   ensure qb-core
   ensure oxmysql
   ensure gps-tracker
   ```

## Configuration

### Main Configuration

```lua
Config = {}

-- Framework Detection
Config.Framework = 'qb-core'        -- 'qb-core', 'esx', 'standalone'
Config.Debug = false                -- Enable debug mode

-- GPS Settings
Config.GPS = {
    enabled = true,
    updateInterval = 1000,          -- Update interval in ms
    maxWaypoints = 50,              -- Maximum waypoints per player
    defaultZoom = 1.0,              -- Default map zoom level
    
    -- Navigation settings
    navigation = {
        enabled = true,
        voiceGuidance = false,      -- Voice navigation (requires audio system)
        showRoute = true,           -- Show route on map
        routeColor = {r = 0, g = 150, b = 255, a = 200},
        routeWidth = 3.0
    },
    
    -- Blip settings
    blips = {
        waypoints = {
            sprite = 8,             -- Blip sprite ID
            color = 3,              -- Blip color
            scale = 0.8,            -- Blip scale
            alpha = 255             -- Blip transparency
        },
        
        destination = {
            sprite = 1,
            color = 1,
            scale = 1.0,
            alpha = 255
        }
    }
}

-- Location Services
Config.Locations = {
    enabled = true,
    saveHistory = true,             -- Save location history
    historyLimit = 100,             -- Maximum history entries
    
    -- Important locations
    presets = {
        {name = "Police Station", x = 428.23, y = -981.28, z = 30.71},
        {name = "Hospital", x = 307.17, y = -1433.46, z = 29.97},
        {name = "Mechanic Shop", x = -347.97, y = -133.33, z = 39.01},
        {name = "Bank", x = 149.46, y = -1042.09, z = 29.37},
        {name = "City Hall", x = -265.02, y = -963.63, z = 31.22}
    }
}

-- Permissions
Config.Permissions = {
    use = 'user',                   -- Who can use GPS
    admin = 'admin',                -- Admin permissions
    moderator = 'mod'               -- Moderator permissions
}
```

### Advanced Configuration

#### Speed Monitoring

```lua
Config.SpeedMonitor = {
    enabled = true,
    units = 'kmh',                  -- 'kmh' or 'mph'
    speedLimits = {
        city = 50,                  -- City speed limit
        highway = 120,              -- Highway speed limit
        school = 25,                -- School zone speed limit
        residential = 35            -- Residential speed limit
    },
    
    -- Speed zones (coordinates define rectangular areas)
    zones = {
        {
            name = "School Zone",
            limit = 25,
            coords = {
                {x = 100, y = 200},     -- Top-left corner
                {x = 300, y = 400}      -- Bottom-right corner
            }
        },
        
        {
            name = "Highway",
            limit = 120,
            coords = {
                {x = 500, y = 600},
                {x = 1000, y = 800}
            }
        }
    },
    
    -- Warnings and penalties
    warnings = {
        enabled = true,
        threshold = 10,             -- Speed over limit to trigger warning
        notify = true,              -- Show notification
        sound = true                -- Play warning sound
    }
}
```

#### Geofencing System

```lua
Config.Geofencing = {
    enabled = true,
    maxZones = 20,                  -- Maximum zones per player
    
    -- Zone types
    types = {
        safe = {
            color = {r = 0, g = 255, b = 0, a = 100},
            blipColor = 2,
            notifications = true
        },
        
        restricted = {
            color = {r = 255, g = 0, b = 0, a = 100},
            blipColor = 1,
            notifications = true,
            kickFromVehicle = false
        },
        
        custom = {
            color = {r = 255, g = 255, b = 0, a = 100},
            blipColor = 5,
            notifications = true
        }
    },
    
    -- Preset zones
    presets = {
        {
            name = "Airport",
            type = "restricted",
            center = {x = -1037.0, y = -2737.6, z = 20.2},
            radius = 500.0,
            message = "You have entered a restricted airspace"
        },
        
        {
            name = "Hospital Safe Zone",
            type = "safe",
            center = {x = 307.17, y = -1433.46, z = 29.97},
            radius = 100.0,
            message = "You are now in a safe zone"
        }
    }
}
```

## Commands and Usage

### Player Commands

```lua
-- Basic GPS Commands
/gps                            -- Open GPS menu
/gps set [name]                 -- Set waypoint at current location
/gps go [name/id]               -- Navigate to waypoint
/gps remove [name/id]           -- Remove waypoint
/gps list                       -- List all waypoints
/gps clear                      -- Clear current navigation

-- Location Commands
/coords                         -- Show current coordinates
/tpto [name/id/x,y,z]          -- Teleport to location (admin)
/tphere [player_id]             -- Teleport player to you (admin)
/goto [player_id]               -- Teleport to player (admin)

-- Advanced Commands
/gps share [player_id] [waypoint] -- Share waypoint with player
/gps history                    -- Show location history
/gps zone create [name] [radius] -- Create geofence zone
/gps zone remove [name]         -- Remove geofence zone

-- Speed Commands
/speed                          -- Show current speed
/speedlimit                     -- Show current speed limit
/gps speed [on/off]             -- Toggle speed monitoring
```

### Admin Commands

```lua
-- GPS Administration
/gpsadmin                       -- Open GPS admin panel
/gpsreload                      -- Reload GPS configuration
/gpsstatus                      -- Show GPS system status

-- Player Management
/gpstrack [player_id]           -- Track player location
/gpshistory [player_id]         -- View player location history
/gpsclear [player_id]           -- Clear player waypoints
/gpsreset [player_id]           -- Reset player GPS data

-- Zone Management
/gpszone list                   -- List all zones
/gpszone create [name] [type] [x] [y] [z] [radius] -- Create zone
/gpszone remove [name]          -- Remove zone
/gpszone edit [name]            -- Edit zone properties

-- System Management
/gpsbackup                      -- Backup GPS database
/gpsimport [file]               -- Import waypoints from file
/gpsexport [player_id]          -- Export player data
```

### Key Bindings

```lua
-- Default keybinds (configurable)
Config.Keybinds = {
    openGPS = 'F9',                 -- Open GPS menu
    quickWaypoint = 'F10',          -- Quick set waypoint
    clearNavigation = 'F11',        -- Clear current navigation
    toggleMap = 'HOME'              -- Toggle full map view
}
```

## Usage Examples

### Setting Waypoints

```lua
-- Client-side example: Setting a waypoint
RegisterCommand('setwaypoint', function(source, args)
    local coords = GetEntityCoords(PlayerPedId())
    local name = table.concat(args, ' ') or 'Custom Waypoint'
    
    TriggerServerEvent('gps:server:setWaypoint', name, coords.x, coords.y, coords.z)
end)

-- Server-side: Save waypoint to database
RegisterNetEvent('gps:server:setWaypoint', function(name, x, y, z)
    local src = source
    local Player = QBCore.Functions.GetPlayer(src)
    if not Player then return end
    
    local citizenid = Player.PlayerData.citizenid
    
    MySQL.insert('INSERT INTO gps_waypoints (citizenid, name, x, y, z) VALUES (?, ?, ?, ?, ?)', {
        citizenid, name, x, y, z
    }, function(insertId)
        TriggerClientEvent('QBCore:Notify', src, 'Waypoint saved: ' .. name, 'success')
        TriggerClientEvent('gps:client:refreshWaypoints', src)
    end)
end)
```

### Navigation System

```lua
-- Client-side navigation
local currentRoute = nil
local navigationActive = false

function StartNavigation(targetCoords)
    if navigationActive then return end
    
    navigationActive = true
    
    -- Create route blip
    currentRoute = AddBlipForCoord(targetCoords.x, targetCoords.y, targetCoords.z)
    SetBlipRoute(currentRoute, true)
    SetBlipRouteColour(currentRoute, 3)
    
    -- Start navigation thread
    CreateThread(function()
        while navigationActive do
            local playerCoords = GetEntityCoords(PlayerPedId())
            local distance = #(playerCoords - targetCoords)
            
            -- Check if destination reached
            if distance < 10.0 then
                TriggerEvent('QBCore:Notify', 'Destination reached!', 'success')
                StopNavigation()
                break
            end
            
            -- Update route if needed
            if distance > 500.0 then
                -- Recalculate route for long distances
                SetBlipRoute(currentRoute, true)
            end
            
            Wait(5000) -- Update every 5 seconds
        end
    end)
end

function StopNavigation()
    navigationActive = false
    
    if currentRoute then
        RemoveBlip(currentRoute)
        currentRoute = nil
    end
    
    TriggerEvent('QBCore:Notify', 'Navigation stopped', 'info')
end
```

### Speed Monitoring

```lua
-- Speed monitoring system
local speedWarningActive = false

CreateThread(function()
    while true do
        local player = PlayerPedId()
        local vehicle = GetVehiclePedIsIn(player, false)
        
        if vehicle ~= 0 and GetPedInVehicleSeat(vehicle, -1) == player then
            local speed = GetEntitySpeed(vehicle) * (Config.SpeedMonitor.units == 'kmh' and 3.6 or 2.237)
            local currentLimit = GetCurrentSpeedLimit() -- Custom function to determine speed limit
            
            if speed > (currentLimit + Config.SpeedMonitor.warnings.threshold) then
                if not speedWarningActive then
                    speedWarningActive = true
                    
                    -- Show speed warning
                    TriggerEvent('QBCore:Notify', 
                        string.format('Speed Warning: %d/%d %s', 
                            math.floor(speed), 
                            currentLimit, 
                            Config.SpeedMonitor.units
                        ), 
                        'warning'
                    )
                    
                    -- Play warning sound
                    if Config.SpeedMonitor.warnings.sound then
                        PlaySoundFrontend(-1, "CHECKPOINT_PERFECT", "HUD_MINI_GAME_SOUNDSET", true)
                    end
                    
                    -- Reset warning after 3 seconds
                    SetTimeout(3000, function()
                        speedWarningActive = false
                    end)
                end
            end
        end
        
        Wait(500)
    end
end)
```

## Integration Examples

### Phone System Integration

```lua
-- Integration with qb-phone or other phone systems
RegisterNetEvent('phone:client:openGPS', function()
    -- Open GPS through phone interface
    SendNUIMessage({
        action = 'openGPS',
        data = {
            waypoints = GetPlayerWaypoints(),
            currentLocation = GetEntityCoords(PlayerPedId())
        }
    })
    SetNuiFocus(true, true)
end)

-- Handle phone GPS interactions
RegisterNUICallback('phone:setGPSDestination', function(data, cb)
    local coords = vector3(data.x, data.y, data.z)
    StartNavigation(coords)
    cb('ok')
end)
```

### Emergency Services Integration

```lua
-- Emergency services can track units
RegisterNetEvent('police:client:trackUnit', function(targetId)
    local Player = QBCore.Functions.GetPlayer(targetId)
    if Player then
        -- Create tracking blip
        CreateThread(function()
            local trackingBlip = nil
            local tracking = true
            
            while tracking do
                local targetPed = GetPlayerPed(GetPlayerFromServerId(targetId))
                if DoesEntityExist(targetPed) then
                    local coords = GetEntityCoords(targetPed)
                    
                    if trackingBlip then
                        RemoveBlip(trackingBlip)
                    end
                    
                    trackingBlip = AddBlipForCoord(coords.x, coords.y, coords.z)
                    SetBlipSprite(trackingBlip, 1)
                    SetBlipColour(trackingBlip, 3)
                    SetBlipAsShortRange(trackingBlip, false)
                    BeginTextCommandSetBlipName("STRING")
                    AddTextComponentString("Unit " .. targetId)
                    EndTextCommandSetBlipName(trackingBlip)
                end
                
                Wait(5000) -- Update every 5 seconds
            end
        end)
    end
end)
```

## API Reference

### Client Exports

```lua
-- Get current coordinates
local coords = exports['gps-tracker']:GetCurrentCoords()

-- Set waypoint programmatically
exports['gps-tracker']:SetWaypoint('Custom Location', x, y, z)

-- Start navigation
exports['gps-tracker']:StartNavigation(targetCoords)

-- Stop navigation
exports['gps-tracker']:StopNavigation()

-- Get all waypoints
local waypoints = exports['gps-tracker']:GetWaypoints()

-- Check if in zone
local inZone = exports['gps-tracker']:IsInZone('Hospital Safe Zone')
```

### Server Exports

```lua
-- Get player location
local coords = exports['gps-tracker']:GetPlayerLocation(playerId)

-- Set player waypoint
exports['gps-tracker']:SetPlayerWaypoint(playerId, name, x, y, z)

-- Get player waypoints
local waypoints = exports['gps-tracker']:GetPlayerWaypoints(playerId)

-- Create zone
exports['gps-tracker']:CreateZone(name, type, center, radius, options)

-- Track player
exports['gps-tracker']:StartTracking(playerId, trackerId)
```

---

**Navigate with precision!** The GPS Tracker script provides comprehensive navigation and location services that enhance the roleplay experience while maintaining optimal performance.

Check out our other [script options](/scripts) or get [support](/support) for installation help.